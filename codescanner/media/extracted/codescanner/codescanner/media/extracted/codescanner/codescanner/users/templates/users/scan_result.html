{% extends "users/dashboard.html" %}

{% block content %}

<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Scan Results</h1>
  <div class="grid grid-cols-2 gap-4">
      <div id="results" class="space-y-2"></div>
      <div id="file-content" class="hidden bg-white p-4 rounded shadow overflow-y-auto max-h-screen"></div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      fetch('/scan_result/')
          .then(response => response.json())
          .then(data => {
              const resultsDiv = document.getElementById('results');
              const fileContentDiv = document.getElementById('file-content');

              if (resultsDiv) {
                  data.forEach(file => {
                      const fileDiv = document.createElement('div');
                      fileDiv.classList.add('file-item', 'p-4', 'bg-white', 'shadow', 'rounded', 'cursor-pointer', 'hover:bg-gray-100');
                      fileDiv.textContent = `Name: ${file.name}`;
                      fileDiv.addEventListener('click', () => {
                          fetch(`/fetch-file-content/?path=${encodeURIComponent(file.path)}`)
                              .then(response => response.text())
                              .then(content => {
                                  fileContentDiv.textContent = content;
                                  fileContentDiv.classList.remove('hidden');
                              })
                              .catch(error => {
                                  console.error('Error fetching file content:', error);
                              });
                      });
                      resultsDiv.appendChild(fileDiv);
                  });
              } else {
                  console.error('Error: results div not found');
              }
          })
          .catch(error => {
              console.error('Error fetching data:', error);
          });
  });
</script>

{% endblock content %}
